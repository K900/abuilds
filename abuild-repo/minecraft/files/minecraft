#!/bin/sh
wget_gui() {
	eval wget -N --progress=bar:force $1 2>&1 | zenity --title="K900's ultra stupid Minecraft launcher" \
		--progress --auto-close --auto-kill --width=400 --no-cancel --text="$2"
}
pushd /usr/share/minecraft/
wget_gui https://s3.amazonaws.com/MinecraftDownload/launcher/minecraft.jar "Checking for updates..."
mkdir -p ~/.minecraft/bin
pushd ~/.minecraft/bin
# JDK7 doesn't work with LWJGL < 2.8.1
if java -version 2>&1 | grep -q 1.7; then
      if [ -f lwjgl.jar ]; then
	      unzip lwjgl.jar org/lwjgl/Sys.class
	      if javap -p -constants org.lwjgl.Sys | grep -q 2.8.1; then
		      lwjgl_ok=1
	      else
		      lwjgl_ok=0
	      fi
	      rm -rf org
      else
	      lwjgl_ok=0
      fi
fi
if [ "$lwjgl_ok" != "1" ]; then
	# Download/install new LWJGL
	wget_gui "http://citylan.dl.sourceforge.net/project/java-game-lib/Official%20Releases/LWJGL%202.8.1/lwjgl-2.8.1.zip" "Downloading lwjgl..."
	unzip -o lwjgl-2.8.1.zip 2>&1 | zenity --title="K900's ultra stupid Minecraft launcher" \
					  --progress --auto-close --auto-kill --width=400 --no-cancel  --text="Extracting lwjgl..."
	mv lwjgl-2.8.1/jar/jinput.jar .
	mv lwjgl-2.8.1/jar/lwjgl.jar .
	mv lwjgl-2.8.1/jar/lwjgl_util.jar .
	mkdir -p natives
	mv lwjgl-2.8.1/native/linux/* natives
	rm -rf lwjgl-2.8.1{,.zip}
	zenity --warning --text="I just updated LWJGL to 2.8.1 for you. You will probably get a black window of death the first time you start Minecraft. Restart the game to make it work."
fi
popd
java -Xmx1024M -Xms512M -jar /usr/share/minecraft/minecraft.jar
popd
