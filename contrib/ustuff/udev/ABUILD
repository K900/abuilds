# ABUILD generated by mkpkg_generator.sh
pkgname=udev
pkgver=181
pkgbuild=1
arch=('auto')

shortdesc=('udev (dynamic device directory system)')
longdesc=('udev provides a dynamic device directory containing only the files for the devices which are actually present. It creates or removes device node files usually located in the /dev directory. udev requires a 2.6 or newer kernel. Kay Sievers is the udev maintainer.')

tags=('base sys-fs')

source="ftp://ftp.kernel.org/pub/linux/utils/kernel/hotplug/$pkgname-$pkgver.tar.xz"

config_files="etc/conf.d/udev etc/udev/udev.conf"

adddep="pciutils usbutils"

build() {
	go_src_dir
	burn_patches
	CFLAGS=$SLKCFLAGS ./configure --sysconfdir=/etc --with-rootprefix=/ --libdir=/usr/lib$LIBDIRSUFFIX \
        --libexecdir=/lib --enable-rule_generator --enable-udev_acl --enable-floppy --enable-edd

	make -j${numjobs}
	make install DESTDIR=${pkgdir}
    
    # make symlinks back to where stuff was before
    mkdir -p ${pkgdir}/sbin
    ln -s /lib/udev/udevd ${pkgdir}/sbin/udevd
    ln -s /usr/bin/udevadm ${pkgdir}/sbin/udevadm

    # clone gentoo initscripts
    mkdir -p ${pkgdir}/etc/udev/rules.d/
    git clone git://git.overlays.gentoo.org/proj/udev-gentoo-scripts.git
    cd udev-gentoo-scripts
    cp -r {conf.d,init.d,modprobe.d} ${pkgdir}/etc
    cp -r helpers/* ${pkgdir}/lib/udev/
    cp rules.d/90-network.rules ${pkgdir}/lib/udev/rules.d
}
